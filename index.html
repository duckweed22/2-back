<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name='viewport' content='user-scalable=no'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2-BACK</title>
    <!-- <link rel="stylesheet" type="text/css" href="../index.css"> -->
</head>
<style>
    * {
        margin: 0;
        padding: 0;
    }

    .title {
        margin: 0 auto;
        text-align: center;
    }

    .button {
        margin: 0 auto;
        text-align: center;
        margin-top: 5px;
    }

    .start {
        width: 100px;
        height: 40px;
        border-color: #ccc;
        background-color: aquamarine;
    }

    .end {
        width: 100px;
        height: 40px;
        border-color: #ccc;
        background-color: beige;
        margin-left: 90px;
    }

    .content {
        width: 100%;
        display: block;
        margin: 20px auto;
    }

    .game_area {
        float: left;
        width: 33%;
        height: 400px;
        background-color: honeydew;
        font-size: 100px;
        color: black;
        text-align: center;
        /* line-height: 250px; */
        padding-top: 100px;
    }

    .feedback {
        float: left;
        width: 33%;
        height: 400px;
        background-color: #ccc;
        padding-top: 100px;
        font-size: 20px;
        text-align: center;
        line-height: 200px;
    }

    .result {
        margin: 5px auto;
        height: 400px;
        background-color: blanchedalmond;
        text-align: center;
        font-size: 20px;
        padding-top: 100px;
    }

    .result h2 {
        margin-bottom: 10px;
    }

    .result p {
        margin: 5px;
    }
</style>

<body>
    <h1 class="title">2-back</h1>
    <div class="button">
        <button class="start">é‡æ–°å¼€å§‹</button>
        <button class="end">ç»“æŸ</button>
    </div>
    <div class="content">
        <div class="feedback"></div>
        <div class="game_area">ç‚¹å‡»å±å¹•å¼€å§‹</div>
    </div>
    <div class='result'>
        <h2>ğŸ‰ç»“æœæ¦œå•ğŸ‰</h2>
        <p></p>
        <p></p>
        <p></p>
        <p></p>
        <p></p>
    </div>

</body>
<script>
    var visual_list = [[8, 6, 6, 8, 7, 8, 5, 4, 5, 6], [4, 5, 5, 6, 7, 5, 5, 4, 3, 4], [2, 3, 4, 3, 3, 2, 4, 4, 5, 6], [3, 4, 5, 4, 3, 4, 2, 1, 1, 2], [4, 1, 2, 3, 2, 4, 9, 8, 5, 6], [3, 2, 4, 2, 4, 5, 6, 7, 4, 5], [2, 3, 2, 1, 4, 5, 4, 6, 6, 7], [7, 6, 7, 5, 3, 4, 6, 5, 5, 7], [3, 5, 6, 5, 7, 8, 9, 4, 5, 6], [1, 3, 4, 2, 5, 2, 6, 5, 4, 7], [4, 3, 5, 3, 3, 4, 6, 5, 4, 1], [0, 9, 8, 0, 6, 5, 6, 3, 4, 5], [3, 5, 0, 5, 3, 4, 7, 8, 9, 9], [4, 5, 2, 6, 0, 7, 6, 4, 5, 4], [3, 5, 2, 3, 2, 8, 6, 5, 0, 7], [1, 2, 6, 8, 6, 7, 9, 0, 0, 5], [4, 7, 8, 6, 8, 4, 5, 4, 1, 3], [6, 4, 6, 3, 4, 5, 4, 9, 5, 5], [2, 3, 6, 7, 6, 8, 6, 3, 3, 4], [3, 5, 6, 7, 4, 7, 0, 3, 0, 2]]
    // è®¾ç½®å‚æ•°
    var set_time = 2;//æ¯ä¸ªæ•°å­—å‡ºç°çš„æŒç»­æ—¶é—´

    var ReactTime = [];//ååº”æ—¶é—´å­˜æ”¾çš„æ•°ç»„|0:ä¸éœ€è¦æŒ‰ä¸”æ²¡æŒ‰ï¼›1:éœ€è¦æŒ‰æ²¡æŒ‰ï¼›-1:ä¸éœ€è¦æŒ‰æŒ‰äº†ï¼›å…¶ä»–æ•°å­—ï¼šéœ€è¦æŒ‰ä¸”æŒ‰ä¸‹çš„æ—¶é—´æˆ³
    var success_count = 0;//ç‚¹å‡»æ­£ç¡®çš„æ¬¡æ•°
    var fail_count = 0;//ç‚¹å‡»é”™è¯¯çš„æ¬¡æ•°
    var miss_count = 0;//é”™è¿‡ç‚¹å‡»çš„æ¬¡æ•°
    var miss_true = 0;//æ­£ç¡®é”™è¿‡çš„æ¬¡æ•°
    var total_time = 1000;//æ¸¸æˆæ€»æ—¶é•¿
    var random_list = [];//éšæœºäº§ç”Ÿçš„æ•°ç»„
    var timer;
    var start_time, end_time;
    var flag = 0;
    var k=0;
    var random_list_pre=[];


    var number = document.querySelector('.game_area')
    var result = document.querySelector('.result')
    var start = document.querySelector('.start')
    var end = document.querySelector('.end')
    var feedback = document.querySelector('.feedback')
    // result.style.display = "none";
    start.addEventListener('click', function () {
        //åˆå§‹åŒ–ï¼Œåˆ·æ–°é¡µé¢
        location.reload();
        console.log('ä½ ç‚¹å‡»äº†å¼€å§‹ï¼')
    })
    end.addEventListener('click', function () {
        total_time = 0;
    })
    if (total_time > 0) {
        number.addEventListener('click', onNumberClick);
    }
    var currentClick = false // å½“å‰æ•°å­—æ˜¯å¦ç‚¹å‡»

    function handleCreateTimer(){
        clearTimeout(timer)
        total_time--;
        end_time = Date.now()
        setNumber()
        currentClick = false
        if(total_time > 0){
            timer = setTimeout(() => {
                // å¼€å§‹æ—¶é—´
                let length = random_list.length
                if(length > 2 && random_list[length - 1] === random_list[length - 3] && currentClick === false){
                    // æ¼ç‚¹
                    miss_count++
                    setGeedBack(1)
                } else {
                    //æ­£ç¡®é”™è¿‡
                    if(length > 2)
                    miss_true++;
                    setGeedBack(0)
                }
                // é‡æ–°å¼€å§‹
                handleCreateTimer()
            }, set_time * 1000)
        } else {
            // æ¸¸æˆç»“æŸ
            number.removeEventListener('click', onNumberClick);
        }
    }

    function onNumberClick(){
        if(currentClick) return
        currentClick = true
        let length = random_list.length
        if (length == 1){
            result = 999;
        }
        else if (length == 2){
            result = 999;
        }
        else if(length > 2){
            let result = 0
            if(random_list[length - 1] === random_list[length - 3]){
                end_time = Date.now()
                result = 'right'//ç‚¹å¯¹äº†
                success_count++
            } else if (random_list[length - 1] != random_list[length - 3])
            {
                result = -1//ç‚¹é”™äº†
                fail_count++
            }
            setGeedBack(result)
        }
        else{
            handleCreateTimer()
        }
        
    }

    // è®¾ç½®éšæœºæ•°å­—
    function setNumber(){
        random_list_pre=PseudoRandom();
        random_number=random_list_pre[k];
        k++;
        if(k>=200){
            k=0;
        }
        random_list.push(random_number)

        number.innerHTML = random_number;
        number.style.background = randomRgbColor()
    }
    // è®¾ç½®åé¦ˆ
    function setGeedBack(result){
        ReactTime.push(result)
        console.log("React_Time:", ReactTime)
        console.log("random_list", random_list)
        setStatisticResult()
        switch (result) {
            case 1:
                feedback.innerHTML = 'æ¼ç‚¹äº†ï¼'
                console.log("æ¼ç‚¹äº†ï¼")
                break;
            case -1:
                feedback.innerHTML = 'ğŸ˜­æŠ±æ­‰ï¼Œç‚¹å‡»é”™äº†ï¼'
                console.log("ç‚¹å‡»é”™äº†")
                break;
            case 0:
                feedback.innerHTML = ' '
                break;
            default:
                feedback.innerHTML = 'ğŸ‰æ­å–œï¼Œç‚¹å‡»å¯¹äº†ï¼'
                console.log("ç‚¹å‡»å¯¹äº†", end_time - start_time)
                break;
        }
    }
    // ç»Ÿè®¡ç»“æœ
    function setStatisticResult(){
        if (ReactTime.length>2){
            var p1 = "æ­£ç¡®ç‚¹å‡»" + success_count + "æ¬¡"
            result.children[1].innerHTML = p1
            var p2 = "é”™è¯¯ç‚¹å‡»" + fail_count + "æ¬¡"
            result.children[2].innerHTML = p2
            var p3 = "æ¼ç‚¹" + miss_count + "æ¬¡"
            result.children[3].innerHTML = p3
            var p4 = "æ­£ç¡®é”™è¿‡" + (miss_true) + "æ¬¡"
            result.children[4].innerHTML = p4
            var true_percent=Math.round((miss_true+success_count)/(ReactTime.length-2)*100)+"%"
            var p5="æ­£ç¡®ç‡" +true_percent
            result.children[5].innerHTML = p5
        }
        
    }
    function randomRgbColor() { //éšæœºç”ŸæˆRGBé¢œè‰²
        var r = Math.floor(Math.random() * 256); //éšæœºç”Ÿæˆ256ä»¥å†…rå€¼
        var g = Math.floor(Math.random() * 256); //éšæœºç”Ÿæˆ256ä»¥å†…gå€¼
        var b = Math.floor(Math.random() * 256); //éšæœºç”Ÿæˆ256ä»¥å†…bå€¼
        var alpha = 0.5;
        return `rgb(${r},${g},${b},${alpha})`; //è¿”å›rgb(r,g,b)æ ¼å¼é¢œè‰²
    }
    function PseudoRandom() {
        var visual_list2=[];
        for(var i=0;i<20;i++){
            n = Math.floor(Math.random() * 20)
            for(var j=0;j<10;j++){
                visual_list2.push(visual_list[n][j])
            }
            
        }
        return visual_list2;

    }
</script>

</html>
